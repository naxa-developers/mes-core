{% extends 'core/base.html' %}
{% load static %}
{% load filters %}
{% block title %}Cluster List{% endblock %}

{% block content %}
<!-- Main Content -->

<section class="content">
    <div class="block-header">
        <div class="row">
            <div class="col-lg-7 col-md-6 col-sm-12">
                <h2>Cluster</h2>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'home' %}"><i class="la la-home"></i> Practical</a></li>
                    <li class="breadcrumb-item active">cluster list</li>
                </ul>
                <button class="btn btn-icon mobile_menu" type="button"><i class="la la-navicon"></i></button>
            </div>
            <div class="col-lg-5 col-md-6 col-sm-12">
                <button class="btn float-right right_icon_toggle_btn" type="button"><i class="la la-arrow-right"></i></button>
                <div class="form-group">
                    <div class="select-option">
                        <select class="custom-select show-tick ms select2" data-placeholder="Select">
                            <option selected>cluster</option>
                            <option>cluster 2</option>
                            <option>cluster 3</option>
                            <option>cluster 4</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="accordion-form project-form">
        <div class="card">
            <div class="card-body">
                <form method="post" action="{% url 'cluster_assign'  pk %}">
                    {% csrf_token %}
                    <!-- accordion -->
                    <div class="cluster-accordion">
                        <div id="accordion">
                            {% for object in selected_activity_group %}
                            <div class="card">
                                    <div class="card-header" id="selected_heading-{{ object.activity_group.id }}">
                                        <h5>
                                            <div class="checkbox">
                                                <input id="selected_ag_id_{{ object.activity_group.id }}" type="checkbox" class="select-all" name="ag_{{ object.activity_group.id }}" checked>
                                                <label for="selected_ag_id_{{ object.activity_group.id }}">{{ object.activity_group.name }}</label>
                                            </div>
                                            <a class="collapsed" role="button" data-toggle="collapse" href="#selected_collapse-{{ object.activity_group.id }}" aria-expanded="true"
                                                aria-controls="selected_collapse-{{ object.activity_group.id }}">
                                            </a>
                                        </h5>
                                    </div>
                                    <div id="selected_collapse-{{ object.activity_group.id }}" class="collapse show" data-parent="#accordion" aria-labelledby="selected_heading-{{ object.activity_group.id }}">
                                        <div class="card-body">
                                            {% for item in object.activity_group.activity.all %}
                                            {% if item|check_cluster_activity:object %}
                                            <div class="form-group">
                                                <div class="checkbox">
                                                    <input id="selected_a_id_{{ item.id }}" type="checkbox" name="a_{{ item.id }}" checked value="true">
                                                    <label for="selected_a_id_{{ item.id }}">{{ item.name }}</label>
                                                </div>
                                                {% with item|get_cluster_activity:object as ca %}
                                                <button type="button" class="btn btn-sm btn-toggle active" data-toggle="button" name="statusChange" onclick="changeValue(this)" aria-pressed="true" autocomplete="off">
                                                    <div class="handle"></div>
                                                </button>
                                                {% if not item.beneficiary_level %}
                                                    <label for="selected_target_{{ item.id }}">Target number</label>
                                                    <input type="text" id="selected_target_{{ item.id }}" name="target_{{ item.id }}" value="{{ ca.target_number }}">
                                                {% endif %}
                                                <div class="select-option">

                                                    <select class="custom-select" name="interval_{{ item.id }}">
                                                        <option value="None" selected="selected">-------</option>
                                                        {% for interval in interval %}
                                                            {% if interval == ca.time_interval %}
                                                                <option value="{{ interval.id }}" selected="selected">{{ interval }}</option>
                                                            {% else %}
                                                                <option value="{{ interval.id }}">{{ interval }}</option>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                                {% endwith %}
                                                {% with item|get_ca_history:object as history %}
                                                {% for item in history %}
                                                {% if item.target_number %}
                                                <label>Previous target: <span>{{ item.target_number }}</span></label>
                                                {% endif %}
                                                {% if item.time_interval %}
                                                <label>Previous time interval:<span>{{ item.time_interval }}</span></label>
                                                {% endif %}
                                                {% if item.updated_date %}
                                                <p>Date updated:<span>{{ item.updated_date }}</span></p>
                                                {% endif %}
                                                {% endfor %}
                                                {% endwith %}
                                            </div>
                                            {% else %}
                                            <div class="form-group">
                                                <div class="checkbox">
                                                    <input id="selected_a_{{ item.id }}" type="checkbox" name="a_{{ item.id }}" value="false">
                                                    <label for="selected_a_{{ item.id }}">{{ item.name }}</label>&nbsp
                                                </div>
                                                <button type="button" class="btn btn-sm btn-toggle" data-toggle="button" name="statusChange" onclick="changeValue(this)" aria-pressed="false" autocomplete="off">
                                                    <div class="handle"></div>
                                                </button>
                                                {% with item|get_cluster_activity:object as ca %}
                                                {% if not item.beneficiary_level %}
                                                    <label for="s_target_{{ item.id }}">Target number</label>
                                                    <input type="text" id="s_target_{{ item.id }}" name="target_{{ item.id }}" value="{{ ca.target_number }}" disabled>
                                                {% endif %}
                                                <div class="select-option">
                                                    <select class="custom-select" name="interval_{{ item.id }}" disabled>
                                                        <option value="None" selected="selected">-------</option>
                                                        {% for interval in interval %}
                                                            {% if interval == ca.time_interval %}
                                                                <option value="{{ interval.id }}" selected="selected">{{ interval }}</option>
                                                            {% else %}
                                                                <option value="{{ interval.id }}">{{ interval }}</option>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                                {% endwith %}
                                                {% with item|get_ca_history:object as history %}
                                                {% for item in history %}
                                                {% if item.target_number %}
                                                <label>Previous target: <span>{{ item.target_number }}</span></label>
                                                {% endif %}
                                                {% if item.time_interval %}
                                                <label>Previous time interval:<span>{{ item.time_interval }}</span></label>
                                                {% endif %}
                                                {% if item.updated_date %}
                                                <p>Date updated:<span>{{ item.updated_date }}</span></p>
                                                {% endif %}
                                                {% endfor %}
                                                {% endwith %}
                                            </div>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            {% for object in activity_group %}
                                <div class="card">
                                    <div class="card-header" id="heading-{{ object.id }}">
                                        <h5>
                                            <div class="checkbox">
                                                <input id="ag_id_{{ object.id }}" type="checkbox" class="select-all" name="ag_{{ object.id }}">
                                                <label for="ag_id_{{ object.id }}">{{ object.name }}</label>
                                            </div>
                                            <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-{{ object.id }}" aria-expanded="true"
                                                aria-controls="collapse-{{ object.id }}">
                                            </a>
                                        </h5>
                                    </div>
                                    <div id="collapse-{{ object.id }}" class="collapse show" data-parent="#accordion" aria-labelledby="heading-{{ object.id }}">
                                        <div class="card-body">
                                            {% for item in object.activity.all %}
                                            <div class="form-group">
                                                <div class="checkbox">
                                                    <input id="a_id_{{ item.id }}" type="checkbox" name="a_{{ item.id }}" value="false">
                                                    <label for="a_id_{{ item.id }}">{{ item.name }}</label>
                                                </div>
                                                <button type="button" class="btn btn-sm btn-toggle" data-toggle="button" name="statusChange" onclick="changeValue(this)" aria-pressed="false" autocomplete="off">
                                                    <div class="handle"></div>
                                                </button>
                                                {% if not item.beneficiary_level %}
                                                    <label for="target_{{ item.id }}">Target number</label>
                                                    <input type="text" id="target_{{ item.id }}" name="target_{{ item.id }}" value="{{ item.target_number }}" disabled>
                                                {% endif %}
                                                <div class="select-option">
                                                    <select class="custom-select" name="interval_{{ item.id }}" disabled>
                                                        <option value="None" selected="selected">-------</option>
                                                        {% for interval in interval %}
                                                            {% if interval == item.time_interval %}
                                                                <option value="{{ interval.id }}" selected="selected">{{ interval }}</option>
                                                            {% else %}
                                                                <option value="{{ interval.id }}">{{ interval }}</option>
                                                            {% endif %}
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="form-footer pull-right">
                        <button type="submit" class="btn">Save</button>
                        <a class="btn remove" href="{% url 'cluster_add' %}"><i class="la la-plus"></i> Add cluster</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script type="text/javascript">

    function changeValue(elem){
        var parentDiv = elem.parentNode.children[0];
        if(parentDiv.children[0].value === "false"){
            parentDiv.children[0].value = "true";
        }
        else if(parentDiv.children[0].value === "true"){
            parentDiv.children[0].value = "false";
        }
        if (elem.parentNode.children[4]){
            if (elem.parentNode.children[3].disabled === true){
                elem.parentNode.children[3].disabled = false;
            }
            else if (elem.parentNode.children[3].disabled === false){
                elem.parentNode.children[3].disabled = true;
            }
            if (elem.parentNode.children[4].children[0].disabled === true){
                elem.parentNode.children[4].children[0].disabled = false;
            }
            else if (elem.parentNode.children[4].children[0].disabled === false){
                elem.parentNode.children[4].children[0].disabled = true;
            }
        }
        else{
            if (elem.parentNode.children[2].children[0].disabled === true){
                elem.parentNode.children[2].children[0].disabled = false;
            }
            else if (elem.parentNode.children[2].children[0].disabled === false){
                elem.parentNode.children[2].children[0].disabled = true;
            }
        }
    }
</script>
{% endblock %}