{% extends 'core/base.html' %}

{% block title %}Activity Create{% endblock %}

{% block content %}

<section class="content">
    <div class="block-header">
        <div class="row">
            <div class="col-lg-7 col-md-6 col-sm-12">
                <h2>Activities</h2>
                <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'home' %}"><i class="la la-home"></i> Practical Action</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'home' %}">Project</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'activity_list' %}">Activity list</a></li>
                        <li class="breadcrumb-item active">{% if form.instance.id %}Edit{% else %}Add{% endif %} Activity</li>
                </ul>
                <button class="btn btn-icon mobile_menu" type="button"><i class="la la-navicon"></i></button>
            </div>
            <div class="col-lg-5 col-md-6 col-sm-12">                
                <button class="btn float-right right_icon_toggle_btn" type="button"><i class="la la-arrow-right"></i></button>
            </div>
        </div>
    </div>
    <div class="project-form">
        <div class="card">
            <div class="card-body">
                <form method="POST">
                    {% csrf_token %}
                    <div class="form-group">
                        <label>{{ form.activity_group.label }}</label>
                        <div class="select-option">
                            {{ form.activity_group }}
                        </div>
                    </div>
                    {% if form.activity_group.errors %}
                    <font color="crimson">{{ form.activity_group.errors }}</font>
                    {% endif %}

                    <div class="form-group">
                        <label>{{ form.name.label }}</label>
                        {{ form.name }}
                    </div>
                    {% if form.name.errors %}
                    <font color="crimson">{{ form.name.errors }}</font>
                    {% endif %}

                    <div class="form-group">
                        <label>{{ form.description.label }}</label>
                        {{ form.description }}
                    </div>
                    {% if form.description.errors %}
                    <font color="crimson">{{ form.description.errors }}</font>
                    {% endif %}

                    <div class="form-group">
                        <label>{{ form.beneficiary_level.label }}</label>
                            {{ form.beneficiary_level }}
                    </div>
                    {% if form.beneficiary_level.errors %}
                    <font color="crimson">{{ form.beneficiary_level.errors }}</font>
                    {% endif %}

                    <div class="form-group" id="target_number">
                        <label>{{ form.target_number.label }}</label>
                            {{ form.target_number }}
                    </div>
                    {% if form.target_number.errors %}
                    <font color="crimson">{{ form.target_number.errors }}</font>
                    {% endif %}

                    <div class="form-group" id="target_unit">
                        <label>{{ form.target_unit.label }}</label>
                            {{ form.target_unit }}
                    </div>
                    {% if form.target_unit.errors %}
                    <font color="crimson">{{ form.target_unit.errors }}</font>
                    {% endif %}

                    <!--<div class="form-group" id="longitude">-->
                        <!--<label>Longitude</label>-->
                        <!--{% if form.instance %}-->
                        <!--<input type="text" name="Longitude" class="form-control" value="{{ form.instance.location.x }}">-->
                        <!--{% else %}-->
                        <!--<input type="text" name="Longitude" class="form-control">-->
                        <!--{% endif %}-->
                    <!--</div>-->

                    <!--<div class="form-group" id="latitude">-->
                        <!--<label>Latitude</label>-->
                        <!--{% if form.instance %}-->
                        <!--<input type="text" name="Latitude" class="form-control" value="{{ form.instance.location.y }}">-->
                        <!--{% else %}-->
                        <!--<input type="text" name="Latitude" class="form-control">-->
                        <!--{% endif %}-->
                    <!--</div>-->

                    <div class="form-group">
                        <label>{{ form.time_interval.label }}</label>
                        <div class="select-option">
                            {{ form.time_interval }}
                        </div>
                    </div>
                    {% if form.start_date.errors %}
                    <font color="crimson">{{ form.time_interval.errors }}</font>
                    {% endif %}

                    <div class="form-group">
                        <label>{{ form.form.label }}</label>
                        <div class="select-option">
                            {{ form.form }}
                        </div>
                    </div>
                    {% if form.form.errors %}
                    <font color="crimson">{{ form.form.errors }}</font>
                    {% endif %}

                    <div class="form-group">
                        <label>{{ form.weight.label }}</label>
                            {{ form.weight }}
                    </div>
                    {% if form.weight.errors %}
                    <font color="crimson">{{ form.weight.errors }}</font>
                    {% endif %}

                    <div class="form-group">
                        <label>{{ form.order.label }}</label>
                        {{ form.order }}
                    </div>
                    {% if form.order.errors %}
                    <font color="crimson">{{ form.order.errors }}</font>
                    {% endif %}
                    <div class="form-group">
                        <label>Select two fields to aggregate</label>
                        <div>
                            <select class="" id="first-field-0" name="first-field-0">
                                <option value="">Select a field</option>
                            </select>
                            <select class="" id="second-field-0" name="second-field-0">
                                <option value="">Select a field</option>
                            </select>
                        </div>
                        
                    </div>
                   
                    <button type="submit" class="btn btn-xs btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}
{% block scripts %}
<script type="text/javascript">
   $(document).ready(function(){
       if ($('#id_beneficiary_level').is(":checked")){
            $('#target_number').hide();
            $('#target_unit').hide();
            <!--$('#latitude').hide();-->
            <!--$('#longitude').hide();-->
       }
        else{
            $('#target_number').show();
            $('#target_unit').show();
            <!--$('#latitude').show();-->
            <!--$('#longitude').show();-->
        }
       $('#id_beneficiary_level').change(function(){
          if ($(this).is(":checked")){
            $('#target_number').hide();
            $('#target_unit').hide();
            <!--$('#latitude').hide();-->
            <!--$('#longitude').hide();-->
          }
          else{
            $('#target_number').show();
            $('#target_unit').show();
            <!--$('#latitude').show();-->
            <!--$('#longitude').show();-->
          }
       });
    });

    $(document).ready(function(){
        var id = $("option:selected", $("#id_form")).val();
        console.log(id);
        if(id > 0){
            var request_url = '{% url "get-aggregation-fields" %}'
            $.ajax({
                url: request_url,
                type: "GET",
                data: {"form_id": id},
                dataType: "json",

                success: function(response){
                    $("#first-field-0").empty();
                    $("#first-field-0").append('<option value="">Select a field</option>');
                    $.each(response, function(key, value){
                        $("#first-field-0").append('<option value="' + value.question + '|' + value.label + '">' + value.label + '</option>');
                    })

                    $("#second-field-0").empty();
                    $("#second-field-0").append('<option value="">Select a field</option>');
                    $.each(response, function(key, value){
                        $("#second-field-0").append('<option value="' + value.question + '|' + value.label + '" >' + value.label + '</option>');
                    })

                    if({{aggregations}} === 0){
                        console.log('asdsad');
                    }
                    else{
                        var selected_value = {{ aggregations|safe }};
                        var first_field_key = Object.keys(selected_value[0])[0];
                        var first_field_value = selected_value[0][first_field_key];
                        $("#first-field-0").append('<option selected value="' + first_field_key + '|' + first_field_value + '">' + first_field_value + '</option>')
                            
                        
                        var second_field_key = Object.keys(selected_value[0])[1];
                        var second_field_value = selected_value[0][second_field_key];
                        $("#second-field-0").append('<option selected value="' + second_field_key + '|' + second_field_value + '">' + second_field_value + '</option>')
                    }
                }            
            });
        }
        

    });
    
    $('#id_form').on('change', function(){
        var id = $("option:selected", this).val();
        var request_url = '{% url "get-aggregation-fields" %}'
        $.ajax({
            url: request_url,
            type: "GET",
            data: {"form_id": id},
            dataType: "json",

            success: function(response){
                $("#first-field-0").empty();
                $("#first-field-0").append('<option value="">Select a field</option>');
                $.each(response, function(key, value){
                    $("#first-field-0").append('<option value="' + value.question + '|' + value.label + '">' + value.label + '</option>');
                })

                $("#second-field-0").empty();
                $("#second-field-0").append('<option value="">Select a field</option>');
                $.each(response, function(key, value){
                    $("#second-field-0").append('<option value="' + value.question + '|' + value.label + '" >' + value.label + '</option>');
                })              
            }

        });
    });

    // $('#id_form').on('click', function(){
    //     var id = $("option:selected", this).val();
    //     var request_url = '{% url "get-aggregation-fields" %}'
    //     $.ajax({
    //         url: request_url,
    //         type: "GET",
    //         data: {"form_id": id},
    //         dataType: "json",

    //         success: function(response){
    //             console.log('adssad');
    //         }

    //     });
    // });
</script>
{% endblock %}